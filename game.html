<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Campus Defender ‚Äî Mobile Friendly with Emoji Fix</title>

<style>
  :root{
    --bg1:#e8f7ef; --bg2:#dff0e2; 
    --accent:#2e7d32; 
    --hudbg:rgba(255,255,255,0.9);
  }
  html,body{
    margin:0; padding:0;
    height:100%;
    background:linear-gradient(var(--bg1),var(--bg2));
    font-family:Arial,Helvetica,sans-serif;
    overscroll-behavior:none;
    -webkit-user-select:none;
    user-select:none;
  }
  #wrap{
    width:100%;
    max-width:1000px;
    margin:auto;
    padding:10px;
  }
  .game-holder{
    position:relative;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,0.12);
    background:linear-gradient(to bottom,#f6fff7 70%,#dff2de);
  }
  canvas{
    display:block;
    width:100%;
    height:auto;
    touch-action:none;
  }

  /* Centered HUD (Option C) */
  .topHud{
    position:absolute;
    top:12px;
    left:50%;
    transform:translateX(-50%);
    background:var(--hudbg);
    padding:10px 20px;
    border-radius:14px;
    display:flex;
    align-items:center;
    gap:20px;
    backdrop-filter:blur(6px);
    z-index:50;
    box-shadow:0 6px 16px rgba(0,0,0,0.12);
  }
  .scoreText{
    font-weight:800;
    font-size:18px;
  }
  .levelText{
    font-size:14px;
    font-weight:700;
    opacity:0.8;
  }
  .hpWrap{
    width:160px; height:14px;
    background:#eee;
    border-radius:8px;
    overflow:hidden;
    border:1px solid #ccc;
  }
  .hpFill{
    height:100%;
    background:linear-gradient(90deg,#66bb6a,#2e7d32);
    transition:width 0.2s;
  }

  .controls{
    margin-top:12px;
    display:flex;
    justify-content:center;
    gap:12px;
  }
  .btn{
    background:var(--accent);
    color:#fff;
    padding:10px 16px;
    border:none;
    border-radius:10px;
    font-weight:700;
    font-size:15px;
  }
  #msg{
    margin-top:10px;
    text-align:center;
    font-weight:700;
    color:#0f3d26;
  }
</style>
</head>
<body>

<div id="wrap">
  <div class="game-holder">

    <!-- HUD -->
    <div class="topHud">
      <div style="text-align:center;">
        <div class="scoreText" id="scoreText">Score: 0</div>
        <div class="levelText" id="levelText">Level: 1</div>
      </div>

      <div class="hpWrap">
        <div id="hpFill" class="hpFill"></div>
      </div>
    </div>

    <canvas id="game" width="960" height="540"></canvas>
  </div>

  <div class="controls">
    <button id="pauseBtn" class="btn">Pause</button>
    <button id="restartBtn" class="btn">Restart</button>
  </div>

  <div id="msg">Tap canvas to start ‚Ä¢ Swipe to move ‚Ä¢ or use ‚Üê ‚Üí keys</div>
</div>


<script>
(() => {
  const LOG_W = 960, LOG_H = 540;
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const scoreText = document.getElementById("scoreText");
  const levelText = document.getElementById("levelText");
  const hpFill = document.getElementById("hpFill");
  const msgEl = document.getElementById("msg");
  const pauseBtn = document.getElementById("pauseBtn");
  const restartBtn = document.getElementById("restartBtn");

  let audioCtx = null;

  let items = [];
  let score = 0;
  let health = 100;
  let level = 1;
  let running = false;
  let paused = false;
  let lastT = 0;

  const player = {
    x: LOG_W/2 - 25,
    y: LOG_H - 80,
    w: 50,
    h: 50,
    vx: 0,
    ax: 0,
    maxSpeed: 6
  };

  // ---------- RESIZE CANVAS (MOBILE FRIENDLY) ----------
  function resizeCanvas(){
    const wrap = document.getElementById("wrap");
    const W = Math.min(wrap.clientWidth, LOG_W);
    const scale = W / LOG_W;
    const dpr = window.devicePixelRatio || 1;

    canvas.style.width = (LOG_W * scale) + "px";
    canvas.style.height = (LOG_H * scale) + "px";

    canvas.width = LOG_W * dpr;
    canvas.height = LOG_H * dpr;
    ctx.setTransform(dpr * scale, 0, 0, dpr * scale, 0, 0);
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();


  // ---------- AUDIO ----------
  function ensureAudio(){
    if (!audioCtx){
      const AC = window.AudioContext || window.webkitAudioContext;
      audioCtx = new AC();
    }
  }
  function playSound(type){
    if (!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    if (type==="good") { o.type="sine"; o.frequency.value=900; g.gain.value=0.04; }
    else if (type==="bad") { o.type="triangle"; o.frequency.value=180; g.gain.value=0.05; }
    else { o.type="sawtooth"; o.frequency.value=140; g.gain.value=0.06; }
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + 0.15);
  }


  // ---------- DRAW BACKGROUND ----------
  function drawBackground(){
    const g = ctx.createLinearGradient(0,0,0,LOG_H);
    g.addColorStop(0,"#f2fbff");
    g.addColorStop(1,"#e8f6ea");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,LOG_W,LOG_H);
  }

  // ---------- DRAW PLAYER ----------
  function drawPlayer(){
    ctx.font = player.w + "px 'Segoe UI Emoji','Noto Color Emoji','Apple Color Emoji',sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("üë§", player.x + player.w/2, player.y + player.h/2);
  }


  // ---------- DRAW ITEMS (WITH EMOJI FIX) ----------
  function drawItems(){
    for (const o of items){
      ctx.save();
      ctx.translate(o.x, o.y);
      ctx.rotate(o.rot);
      ctx.font = o.size + "px 'Segoe UI Emoji','Noto Color Emoji','Apple Color Emoji',sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(o.emoji, 0, 0);
      ctx.restore();
    }
  }


  // ---------- SPAWN ITEMS ----------
  function spawnItem(){
    const bad = ["üíä","üíâ","üö¨"];
    const good = ["üçè","ü•ó","ü•¶"];

    const isGood = Math.random() < 0.5;
    const emoji = isGood ?
      good[Math.floor(Math.random()*good.length)] :
      bad[Math.floor(Math.random()*bad.length)];

    items.push({
      x: Math.random()*(LOG_W-40)+20,
      y: -40,
      emoji,
      size: 40 + Math.random()*20,
      vy: 2 + Math.random()*2,
      rot: Math.random()*Math.PI,
      r: 24,
      good: isGood
    });
  }


  // ---------- COLLISION ----------
  function collide(px,py,pw,ph,cx,cy,r){
    const dx = Math.max(px, Math.min(cx, px+pw)) - cx;
    const dy = Math.max(py, Math.min(cy, py+ph)) - cy;
    return (dx*dx + dy*dy) < r*r;
  }


  // ---------- RESET GAME ----------
  function resetGame(){
    items = [];
    score = 0;
    health = 100;
    level = 1;
    running = true;
    paused = false;
    scoreText.textContent = "Score: 0";
    levelText.textContent = "Level: 1";
    hpFill.style.width = "100%";
    msgEl.textContent = "Collect healthy items ‚Äî avoid drugs!";
  }


  // ---------- UPDATE ----------
  function update(t){
    if (!running || paused){ lastT = t; return; }
    const dt = (t - lastT) / 16;
    lastT = t;

    // Move player
    player.vx += player.ax * dt;
    player.vx *= 0.9;
    if (player.vx > player.maxSpeed) player.vx = player.maxSpeed;
    if (player.vx < -player.maxSpeed) player.vx = -player.maxSpeed;
    player.x += player.vx * dt;

    if (player.x < 0) player.x = 0;
    if (player.x + player.w > LOG_W) player.x = LOG_W - player.w;

    // Spawn
    if (Math.random() < 0.03 + level*0.002) spawnItem();

    // Items update
    for (let i = items.length-1; i>=0; i--){
      const o = items[i];
      o.y += o.vy * dt;
      o.rot += 0.01;

      if (collide(player.x,player.y,player.w,player.h,o.x,o.y,o.r)){
        if (o.good){
          score += 10;
          playSound("good");
        } else {
          health -= 15;
          playSound("bad");
        }
        items.splice(i,1);

        scoreText.textContent = "Score: " + score;
        hpFill.style.width = Math.max(0,health) + "%";
        continue;
      }
      if (o.y > LOG_H + 60) items.splice(i,1);
    }

    // Level up
    if (score >= level * 120){
      level++;
      levelText.textContent = "Level: " + level;
      msgEl.textContent = "Level " + level + " ‚Äî Keep choosing health!";
      paused = true;
      setTimeout(()=>{paused=false; msgEl.textContent="";}, 1200);
    }

    // Game Over
    if (health <= 0){
      running = false;
      msgEl.textContent = "Game Over ‚Äî Stay Drug-Free";
      playSound("gameOver");
    }
  }


  // ---------- DRAW ----------
  function draw(){
    ctx.clearRect(0,0,LOG_W,LOG_H);
    drawBackground();
    drawItems();
    drawPlayer();
  }


  // ---------- LOOP ----------
  function loop(t){
    update(t);
    draw();
    requestAnimationFrame(loop);
  }


  // ---------- CONTROLS ----------
  window.addEventListener("keydown", (e)=>{
    if (e.key==="ArrowLeft") player.ax = -1.0;
    if (e.key==="ArrowRight") player.ax = 1.0;
    ensureAudio();
    running = true;
  });
  window.addEventListener("keyup", ()=> player.ax = 0 );

  // Touch
  let touchX = null;
  canvas.addEventListener("touchstart", e=>{
    ensureAudio();
    running = true;
    if (e.touches.length===1)
      touchX = e.touches[0].clientX;
  });
  canvas.addEventListener("touchmove", e=>{
    if (e.touches.length!==1) return;
    const nx = e.touches[0].clientX;
    const dx = nx - touchX;
    touchX = nx;
    const scale = canvas.clientWidth / LOG_W;
    player.x += dx / scale;
  });
  canvas.addEventListener("touchend", ()=> touchX=null );


  // Buttons
  pauseBtn.addEventListener("click", ()=>{
    paused = !paused;
    pauseBtn.textContent = paused ? "Resume" : "Pause";
  });
  restartBtn.addEventListener("click", resetGame);


  // START GAME
  resetGame();
  requestAnimationFrame(loop);

})();
</script>

</body>
</html>

